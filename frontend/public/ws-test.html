<!doctype html>
<html>
  <body>
    <h3>WS Test</h3>
    <div>
      <label>Room Code: <input id="room" value="5007" /></label>
      <button onclick="joinLobby()">Join Lobby</button>
      <button onclick="leaveLobby()">Leave Lobby</button>
    </div>
    <div>
      <label>Game ID: <input id="game" value="g_xxxxx" /></label>
      <button onclick="joinGame()">Join Game</button>
      <button onclick="leaveGame()">Leave Game</button>
    </div>
    <pre
      id="log"
      style="
        border: 1px solid #ddd;
        padding: 8px;
        margin-top: 12px;
        height: 240px;
        overflow: auto;
      "
    ></pre>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const logEl = document.getElementById("log");
      const log = (...args) => {
        const line = args
          .map((a) => (typeof a === "object" ? JSON.stringify(a) : String(a)))
          .join(" ");
        logEl.textContent += line + "\n";
        logEl.scrollTop = logEl.scrollHeight;
        console.log(...args);
      };

      const socket = io("http://localhost:3000", { withCredentials: true });

      socket.on("connect", () => log("connected:", socket.id));
      socket.on("disconnect", (reason) => log("disconnected:", reason));

      // Lobby events
      socket.on("lobby:joined", (d) => log("lobby:joined", d));
      socket.on("lobby:left", (d) => log("lobby:left", d));
      socket.on("lobby:update", (d) => log("lobby:update", d));
      socket.on("lobby:closed", (d) => {
        log("lobby:closed", d);
        if (d?.gameId) {
          // auto-fill and join the game room
          document.getElementById("game").value = d.gameId;
          log("auto-joining game:", d.gameId);
          socket.emit("game:join", { gameId: d.gameId });
        }
      });
      socket.on("lobby:reopened", (d) => log("lobby:reopened", d));

      // Game events
      socket.on("game:joined", (d) => log("game:joined", d));
      socket.on("game:left", (d) => log("game:left", d));
      socket.on("game:started", (d) => log("game:started", d));
      socket.on("game:score", (d) => log("game:score", d));
      socket.on("game:ended", (d) => log("game:ended", d));

      // Buttons
      function joinLobby() {
        const roomCode = document.getElementById("room").value.trim();
        log("manually joining lobby:", roomCode);
        socket.emit("lobby:join", { roomCode });
      }
      function leaveLobby() {
        const roomCode = document.getElementById("room").value.trim();
        log("leaving lobby:", roomCode);
        socket.emit("lobby:leave", { roomCode });
      }
      function joinGame() {
        const gameId = document.getElementById("game").value.trim();
        log("manually joining game:", gameId);
        socket.emit("game:join", { gameId });
      }
      function leaveGame() {
        const gameId = document.getElementById("game").value.trim();
        log("leaving game:", gameId);
        socket.emit("game:leave", { gameId });
      }
    </script>
  </body>
</html>
